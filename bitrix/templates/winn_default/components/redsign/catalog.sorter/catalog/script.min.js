!function(t){"use strict";t.RSCatalogSorter||(t.RSCatalogSorter=function(t){this.items=[],this.errorCode=0,this.node={},this.target=null,this.sorter=null,this.pagination=null,this.lazyload=null,"object"==typeof t&&(this.visual=t.VISUAL),0===this.errorCode&&BX.ready(BX.delegate(this.init,this))},t.RSCatalogSorter.prototype={init:function(){this.obSorter=BX(this.visual.ID),this.obSorter||(this.errorCode=-1),this.items=BX.findChildren(this.obSorter,{tagName:"a"},!0),this.items.length>0&&BX.bindDelegate(this.obSorter,"click",{tagName:"a"},BX.proxy(this.catalogRefresh,this)),this.ajaxId=this.visual.TARGET_ID,this.ajaxId&&(this.node.target=BX(this.ajaxId)),this.node.target&&(this.node.container=this.node.target.querySelector('[data-entity^="container-"]'),this.node.pagination=this.node.target.querySelectorAll('[data-entity="pagination"]'),this.node.lazyload=this.node.target.querySelector('[data-entity="lazyload"]'))},catalogRefresh:function(t){var e=BX.proxy_context;if(e){var i={},o=e.getAttribute("href");i.action="updateItems",o.indexOf("?")<0?o+="?":"&"!=o.slice(-1)&&(o+="&"),o+="action=updateItems",null!=this.ajaxId&&(o+="&AJAX_ID="+this.ajaxId),this.formPosting||(this.formPosting=!0,this.showWait(),this.sendRequest(o,i)),t.preventDefault()}},sendRequest:function(t,e){var i={};this.ajaxId&&(i.AJAX_ID=this.ajaxId),new RS.Utils.PageAnimate({animation:"pageOutLine",durationOut:2500,onComplete:function(){}}).start(),BX.ajax({url:-1!==t.indexOf("clear_cache=Y")?BX.util.add_url_param(t,{clear_cache:"Y"}):t,method:"POST",dataType:"json",timeout:60,data:BX.merge(i,e),onsuccess:BX.delegate(function(t){t&&t.JS&&BX.ajax.processScripts(BX.processHTML(t.JS).SCRIPT,!1,BX.delegate(function(){this.showAction(t,e)},this))},this)})},showAction:function(t,e){if(e){switch(e.action){case"updateItems":this.processCatalogRefreshAction(t)}new RS.Utils.PageAnimate({animation:"pageInLine",onComplete:function(){}}).start()}},processCatalogRefreshAction:function(t){this.formPosting=!1,t&&(this.refresh(t.sorter),this.processSection(t.section),this.closeWait())},processSection:function(t){if(t){var e=BX.processHTML(t,!1);this.node.target&&(this.node.target.innerHTML=e.HTML),BX.ajax.processScripts(e.SCRIPT),void 0!==RS&&RS.Init(this.node.target)}},refresh:function(t){if(t){var e=BX.processHTML(t,!1);this.obSorter&&(this.obSorter.innerHTML=e.HTML),BX.ajax.processScripts(e.SCRIPT),void 0!==RS&&RS.Init(this.obSorter)}},showWait:function(){BX.addClass(this.node.target,"overlay is-loading")},closeWait:function(){BX.removeClass(this.node.target,"overlay is-loading")}})}(window);