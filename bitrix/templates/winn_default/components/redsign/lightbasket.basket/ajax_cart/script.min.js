!function(t){"use strict";t.RSFlyingCart||(t.RSFlyingCart=function(t){this.id=t.ID,this.$cart=$("#"+this.id),this.templateName=t.TEMPLATE_NAME,this.arParams=t.TEMPLATE_PARAMS,this.ajaxPath=t.AJAX_PATH,this.siteId=t.SITE_ID,this.timeout=0,BX.addCustomEvent("clear.rs_lightbasket",$.proxy(this.refresh,this)),BX.addCustomEvent("delete.rs_lightbasket",$.proxy(this.refresh,this)),BX.addCustomEvent("update.rs_lightbasket",$.proxy(this.refresh,this)),this.initContentEvents()},t.RSFlyingCart.prototype={initContentEvents:function(){this.$cart.find("[data-id]").each(function(t,i){$(i).find(".product-amount-field-btn-minus").on("click",this.quantityDown),$(i).find(".product-amount-field-btn-plus").on("click",this.quantityUp),$(i).find(".product-amount-field").on("change",$.proxy(this.updateQuantity,this)),$(i).find(".js-cart__remove").on("click",$.proxy(function(t){t.preventDefault(),this.startLoader();var i=parseInt($(t.target).closest("[data-id]").data("id"));Basket.delete(i)},this))}.bind(this))},refresh:function(){this.startLoader(),BX.ajax({url:this.ajaxPath,method:"POST",dataType:"json",data:{action:"get",sessid:BX.bitrix_sessid(),templateName:this.templateName,arParams:this.arParams,siteId:this.siteId,ajax_basket:"Y"},onsuccess:function(t){this.$cart.html(t.CONTENT),RS.Init&&RS.Init(this.$cart),this.initContentEvents(),this.endLoader()}.bind(this)})},updateQuantity:function(t){clearTimeout(this.timeout),this.timeout=setTimeout(function(){this.startLoader();var i=$(t.target),a=parseFloat(i.val(),10),e=parseInt(i.closest("[data-id]").data("id"));$.Deferred(),Basket.updateQuantity(e,a)}.bind(this),500)},isShown:function(){return this.$cart.hasClass("is-open")},startLoader:function(){this.$cart.addClass("is-loading")},endLoader:function(){this.$cart.removeClass("is-loading")},quantityUp:function(t){var i=$(t.target).closest("[data-id]").find(".product-amount-field");if(i.length<1)return!1;var a=parseFloat(i.val(),10);i.val(++a).trigger("change")},quantityDown:function(t){var i=$(t.target).closest("[data-id]").find(".product-amount-field"),a=parseFloat(i.val(),10);if(i.length<1)return!1;i.val(--a>0?a:1).trigger("change")}})}(window);