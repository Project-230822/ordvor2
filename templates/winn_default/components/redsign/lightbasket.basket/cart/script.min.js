!function(t){"use strict";t.RSLightbasketCart||(t.RSLightbasketCart=function(t){this.id=t.ID,this.$cart=$("#"+this.id),this.templateName=t.TEMPLATE_NAME,this.arParams=t.TEMPLATE_PARAMS,this.ajaxPath=t.AJAX_PATH,this.siteId=t.SITE_ID,this.timeout=0,BX.addCustomEvent("clear.rs_lightbasket",$.proxy(this.refresh,this)),BX.addCustomEvent("delete.rs_lightbasket",$.proxy(this.refresh,this)),BX.addCustomEvent("update.rs_lightbasket",$.proxy(this.refresh,this)),this.initContentEvents()},t.RSLightbasketCart.prototype={initContentEvents:function(){this.$cart.find("[data-id]").each(function(t,a){$(a).find(".product-amount-field-btn-minus").on("click",this.quantityDown),$(a).find(".product-amount-field-btn-plus").on("click",this.quantityUp),$(a).find(".product-amount-field").on("change",$.proxy(this.updateQuantity,this)),$(a).find(".js-cart__remove").on("click",$.proxy(function(t){t.preventDefault(),this.startLoader();var a=parseInt($(t.target).closest("[data-id]").data("id"));Basket.delete(a)},this))}.bind(this))},refresh:function(){this.startLoader(),BX.ajax({url:this.ajaxPath,method:"POST",dataType:"json",data:{action:"get",sessid:BX.bitrix_sessid(),templateName:this.templateName,arParams:this.arParams,siteId:this.siteId,ajax_basket:"Y"},onsuccess:function(t){this.$cart.html(t.CONTENT),RS.Init&&RS.Init(this.$cart),this.initContentEvents(),this.endLoader()}.bind(this)})},updateQuantity:function(t){clearTimeout(this.timeout),this.timeout=setTimeout(function(){this.startLoader();var a=$(t.target),i=parseFloat(a.val(),10),e=parseInt(a.closest("[data-id]").data("id"));$.Deferred(),Basket.updateQuantity(e,i)}.bind(this),500)},startLoader:function(){this.$cart.addClass("overlay is-loading")},endLoader:function(){this.$cart.removeClass("overlay is-loading")},quantityUp:function(t){var a=$(t.target).closest("[data-id]").find(".product-amount-field");if(a.length<1)return!1;var i=parseFloat(a.val(),10);a.val(++i).trigger("change")},quantityDown:function(t){var a=$(t.target).closest("[data-id]").find(".product-amount-field"),i=parseFloat(a.val(),10);if(a.length<1)return!1;a.val(--i>0?i:1).trigger("change")}})}(window);